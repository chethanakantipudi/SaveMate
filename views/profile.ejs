<%- include('partials/header') %>

<style>
    .profile-grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 2rem;
    }
    .profile-main {
        grid-column: span 12;
    }
    .profile-sidebar {
        grid-column: span 12;
    }
    @media (min-width: 768px) {
        .profile-main {
            grid-column: span 7;
        }
        .profile-sidebar {
            grid-column: span 5;
        }
    }
    .profile-header {
        text-align: center;
        margin-bottom: 2rem;
    }
    .profile-header .avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background-color: var(--primary-color);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        margin: 0 auto 1rem;
    }
    .profile-details-list {
        list-style: none;
    }
    .profile-details-list li {
        display: flex;
        justify-content: space-between;
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }
    .profile-details-list li:last-child {
        border-bottom: none;
    }
    .profile-details-list .label {
        font-weight: 500;
        color: var(--text-secondary);
    }
    .profile-actions {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
    }
    .quick-goal-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        border-radius: var(--radius-md);
        background-color: var(--bg-secondary);
        transition: background-color var(--transition-speed) ease;
    }
    .quick-goal-card:hover {
        background-color: var(--border-color);
    }
    .quick-goal-card-img {
        width: 50px;
        height: 50px;
        border-radius: var(--radius-md);
        object-fit: cover;
    }
</style>

<div class="container page-container animate-fade-in">
    <div class="profile-grid">
        <div class="profile-main">
            <div class="card">
                <div class="profile-header">
                    <div class="avatar"><%= user.fname.charAt(0) %></div>
                    <h2><%= user.fname %> <%= user.lname %></h2>
                </div>
                
                <ul class="profile-details-list">
                    <li>
                        <span class="label">Username</span>
                        <span><%= user.username %></span>
                    </li>
                    <li>
                        <span class="label">Email Address</span>
                        <span><%= user.email || 'Not Provided' %></span>
                    </li>
                    <li>
                        <span class="label">Currency</span>
                        <span>
                            <% if (user.currency == '£') { %>
                                GBP (£)
                            <% } else if (user.currency == '$') { %>
                                USD ($)
                            <% } else { %>
                                Rupee (₹)
                            <% } %>
                        </span>
                    </li>
                </ul>
                
                <div class="profile-actions">
                    <a href="#update-profile" class="btn btn-primary">Update Profile</a>
                    <a href="#update-password" class="btn btn-secondary">Update Password</a>
                </div>
            </div>
        </div>

        <div class="profile-sidebar">
            <div class="card">
                <h3 class="card-title" style="border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                    Your Goals
                </h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <% if (goals && goals.length > 0) { %>
                        <% goals.forEach(function(goal){ %>
                            <a href="/goal/<%= goal.id %>" class="quick-goal-card">
                                <img src="<%= goal.image_url %>" alt="<%= goal.goal_name %>" class="quick-goal-card-img">
                                <div>
                                    <div style="font-weight: 600;"><%= goal.goal_name %></div>
                                    <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                        <%= Math.round((Number(goal.current_total) / (Number(goal.end_total) || 1)) * 100) %>% complete
                                    </div>
                                </div>
                            </a>
                        <% }); %>
                    <% } else { %>
                        <p>You don't have any active goals yet.</p>
                    <% } %>
                    <% if (goals && goals.length < 4) { %>
                        <a href="/dashboard" class="btn btn-secondary" style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i> Add New Goal
                        </a>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>

<%- include('partials/footer') %>